setup.template.settings:
  index.number_of_shards: 1
  index.codec: best_compression
  index.number_of_replicas: 0

setup.dashboards.enabled: true

setup.kibana:
  host: "kibana:5601"

output.elasticsearch:
  hosts: ["elasticsearch:9200"]

logging.json: true
logging.metrics.enabled: false

filebeat.autodiscover:
  providers:
    - type: docker
      templates:
      - condition:
          contains:
            docker.container.image: "apm-server"
        config:
          - type: docker
            containers.ids:
              - "${data.docker.container.id}"
            processors:
              - decode_json_fields:
                  fields: ["message"]
                  target: "apm-server"
      - condition:
          contains:
            docker.container.image: "filebeat"
        config:
          - type: docker
            containers.ids:
              - "${data.docker.container.id}"
            processors:
              - decode_json_fields:
                  fields: ["message"]
                  target: "filebeat"
      - condition:
          and:
            - not:
                contains:
                  docker.container.image: "apm-server"
            - not:
                contains:
                  docker.container.image: "filebeat"
        config:
          - type: docker
            containers.ids:
              - "${data.docker.container.id}"
